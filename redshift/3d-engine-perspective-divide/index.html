<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Perspective Divide</title>
  <link rel="stylesheet" href="../../style.css">
  <link rel="icon" type="image/svg+xml" href="../favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        processEscapes: true
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root {
      /* Default (Night) */
      --bg-color: #000000;
      /* Pure Black */
      --text-color: #dcddde;
      --accent-color: #ff3333;
      /* Redshift Red */
      --link-color: #ff3333;
      --code-bg: #111111;
      /* Slightly lighter than black */
      --quote-border: #ff3333;
      --font-main: "Space Mono", monospace;
    }

    /* Read Mode (Warm/Flux-like) */
    [data-theme="read"] {
      --bg-color: #1a1816;
      --text-color: #d6c4a8;
      /* Warm sepia text */
      --accent-color: #ff5555;
      /* Warmer red/orange */
      --link-color: #ff5555;
      --code-bg: #2b2724;
      --quote-border: #ff5555;
    }

    /* Day Mode (White) */
    [data-theme="day"] {
      --bg-color: #ffffff;
      --text-color: #333333;
      --accent-color: #cc0000;
      /* Darker red for contrast */
      --link-color: #cc0000;
      --code-bg: #f5f5f5;
      --quote-border: #cc0000;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: var(--font-main);
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
      font-size: 16px;
      transition: background-color 0.3s, color 0.3s;
    }

    /* Typography */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      color: inherit;
      margin-top: 2rem;
      margin-bottom: 1rem;
      font-weight: 700;
    }

    [data-theme="day"] h1,
    [data-theme="day"] h2 {
      color: #000;
    }

    h1 {
      border-bottom: 1px solid var(--code-bg);
      padding-bottom: 0.5rem;
    }

    p {
      margin-bottom: 1.5rem;
    }

    /* Links */
    a {
      color: var(--link-color);
      text-decoration: underline;
      font-family: "Space Mono", monospace;
      transition: opacity 0.2s, letter-spacing 0.2s;
    }

    a:hover {
      opacity: 0.8;
      cursor: pointer;
      letter-spacing: 1px;
    }

    /* Bold & Italic */
    strong {
      color: inherit;
      font-weight: 900;
    }

    em {
      color: var(--accent-color);
      font-style: italic;
    }

    /* Bold + Italic */
    strong em,
    em strong {
      color: var(--accent-color);
      font-weight: 900;
      font-style: italic;
    }

    /* Images */
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 2rem auto;
      border-radius: 4px;
    }

    /* Code Blocks */
    pre {
      background-color: var(--code-bg);
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      margin-bottom: 1.5rem;
      border: 1px solid #333;
    }

    code {
      font-family: var(--font-main);
      background-color: rgba(128, 128, 128, 0.1);
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-size: 0.9em;
    }

    pre code {
      background-color: transparent;
      padding: 0;
    }

    /* Blockquotes */
    blockquote {
      border-left: 4px solid var(--quote-border);
      margin: 1.5rem 0;
      padding-left: 1rem;
      color: inherit;
      opacity: 0.8;
      font-style: italic;
    }

    /* Lists */
    ul,
    ol {
      padding-left: 2rem;
      margin-bottom: 1.5rem;
    }

    li {
      margin-bottom: 0.5rem;
    }

    /* Navigation */
    .nav {
      margin-bottom: 3rem;
      font-size: 0.9rem;
      opacity: 0.7;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav a {
      color: var(--text-color);
      text-decoration: none;
    }

    .nav a:hover {
      color: var(--accent-color);
      text-decoration: underline;
    }

    /* Theme Switcher */
    .theme-switcher {
      display: flex;
      gap: 1rem;
      font-size: 1.2rem;
      cursor: pointer;
      user-select: none;
    }

    .theme-btn {
      opacity: 0.5;
      transition: opacity 0.2s, transform 0.2s;
      display: flex;
      align-items: center;
    }

    .theme-btn:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .theme-btn.active {
      opacity: 1;
      transform: scale(1.2);
    }

    /* Hide raw markdown */
    #markdown-content {
      display: none;
    }
  </style>
</head>

<body>
  <div class="nav">
    <a href="../index.html">~/back-to-menu</a>
    <div class="theme-switcher">
      <span class="theme-btn active" onclick="setTheme('night')" title="Night Mode">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </span>
      <span class="theme-btn" onclick="setTheme('read')" title="Read Mode (Warm)">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
      </span>
      <span class="theme-btn" onclick="setTheme('day')" title="Day Mode">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
      </span>
    </div>
  </div>
  <div id="content"></div>

  <!-- PASTE YOUR MARKDOWN HERE INSIDE THE SCRIPT TAG -->
  <script id="markdown-content" type="text/markdown">
# The math behind the 3D rendering engine - the perspective divide, a very rushed overview

Background: So I recently picked up a course at my college on understanding the geometry that goes on behind our vision. I thought a nice lil' project I could make using the concepts I learnt in the course would be a 3D renderer. So this short blog is just going to be explaining the math behind the project [Tesseris](https://github.com/AdalricP/3D-Rendering-Engine)

## Part.1. Vanishing points & the horizon line.

In a 2D space, when you look at parallel lines, they *never* intersect, right? Well, that changes with perspective. For example, this image of rail lines here. You see how even though they are parallel lines, they do *eventually* intersect at a far off point? Well, that point is known as the *vanishing point* and in projective geometry, all parallel lines meet at a certain vanishing point.

![[../media/pasted-image-20250818140258.png]]

Now, the *height* of this vanishing point is known as the *horizon line.* In fact, all vanishing points in an image *lie on the horizon line.*

![[../media/pasted-image-20250818141808.png]]

## Part.2. The Affine Plane to the Projective Plane

Let's go a bit mathematical, we first start with the ordinary plane you may have already seen in geometry, the *affine* plane. We'll say that the affine plane is a *set* or a *collection*, and it's elements are known as *points*, oh, we also have a collection of collections, *subsets* within the *set* known as *lines.*

Now, we take for granted that these three rules are true for the affine plane, in math, these basic assumptions are called *axioms* out of which all truth is based. So, we have three axioms,

$A1$ If we have two unique points P & Q, there is one and *ONLY* one line that contains both P and Q.
Two lines are parallel if they are equal (both have P & Q) or if they have no points in common.
$A2$ If you have a line $l$ and a point $P$ there is only ONE line $m$ which is parallel to $l$ and passes through $P$.
$A3$ You can pick at least THREE points which aren't in a line.

This defines our affine plane. Now, to get to our *projective plane*, we have to add in the notion of certain "points at infinity." How? Let's take a look. Let A be our affine plane, and let's take a line $l$ on our plane, $[l]$ is known as the *pencil* of lines parallel to $l$, a *pencil* can mean either the set of all lines passing through a point $P$ or the set of all of the lines that are parallel to our line.

You can think of the *projection* of this *pencil* as the *vanishing point.* $P^* = [l]$, so we can define our completed projective plane $S$ as the set of all the points in $A$ + all these *ideal* points of $A$.

The projective plane follows $4$ axioms.
P1 Two distinct points P, Q of S lie on one and ONLY one line.
P2 Any two lines meet in at least one point. --> This is what leads to the vanishing points
P3 There exists at least THREE points which are not in a line
P4 Every line contains AT LEAST three points.

## Part.3. Analytical definition for the projective plane

Now that we have defined our projective plane, our next goal is to develop an analytical definition of such. A point of $S$ can be thought of as a line through $O$ the origin. Now, we can represent this point corresponding to the line as $(x_1, x_2, x_3)$ different from the point $(0, 0, 0)$. The numbers $x_1, x_2, x_3$ are the *homogenous co-ordinates* of $P$. Any other point on the line $l$ can be thought of as $(\lambda x_1, \lambda x_2, \lambda x_3)$ where $\lambda \neq 0$. And actually - both $(x_1, x_2, x_3)$ and $(x'_1, x'_2, x'_3)$ where $x'_i = \lambda x_i$ represent the SAME points.

Let's take on one hand S, whose points are given by homogenous coordinates $(x_1, x_2, x_3), x_i \in \mathbb{R}$, on the other hand, let's take our euclidean plane $A$ with cartesian coordinates $x, y$ which completes to the real projective plane $S'$. So the points of $S'$ are the points of $A$ + the ideal of points. Now a *pencil* of parallel lines is just a collection of all the parallel lines right? So since they're parallel, they must all have the same slope $m$ which we can therefore use to determine that pencil. So we can say that the *ideal points* are described by the coordinate $m$.

Now let's create a transformation from one hand to another, $T: S \to S'$, and let $(x_1, x_2, x_3) = P$ be a point of $S$, if $x_3 = 0$ we simply get our vanishing points with slope $m = x_2 / x_1$ this makes sense because $x_1 \& x_2$ can't both be 0.

now if $x_3 \neq 0$ we can define $T(P)$ to be the point of A with the coordinates $x = \frac{x_1}{x_3}$ and $y = \frac{x_2}{x_3}$ note here, if we replace $(x_1, x_2, x_3)$ by $(\lambda x_1, \lambda x_2, \lambda x_3)$ our values for $x$ and $y$ stay the same.
Now, we can use this to find everyone point on A, in fact, any point with coordinates $(x, y)$ is the image of the point on $S$ with homogenous coordinates $(x, y, 1)$. Which brings us to the main part: The perspective divide.

## Part.4. The perspective divide

We will extend our current definition into 3D with $x, y, z$ components, and the 4D homogeneous coordinate system with $\omega$ or $x_4$ Which gives us,
$x = \frac{x_1}{x_4}, y = \frac{x_2}{x_4}, z = \frac{x_3}{x_4}$
Where lines through the origin in $\mathbb{R}^4$ represent points in the 3D coordinate system.

The division by $x_4$ or $\omega$ is known as *the perspective divide* in computer graphics, this is what corrects the position of objects according to the perspective, provides the vanishing point, and makes further objects appear smaller.

Further Reading: This was just a (very) brief overview, if you'd like to understand the math better - I'd recommend going through the first handful of pages of [this book by Robin Hartshorne](https://www.math.columbia.edu/~dejong/reu/lib/exe/fetch.php?media=hartshorne_foundations_of_projective_geometry.pdf) for deeper understanding

---
    </script>

  <script>
    const markdown = document.getElementById('markdown-content').textContent;

    // Protect LaTeX from marked.js
    // We replace $$...$$ and $...$ with placeholders
    const mathExpressions = [];
    let protectedMarkdown = markdown.replace(/\$\$([\s\S]*?)\$\$|\$((?:\\.|[^$])*)\$/g, (match) => {
      mathExpressions.push(match);
      return `MATH_EXPRESSION_${mathExpressions.length - 1}`;
    });

    // Handle Obsidian-style image links ![[path]] -> ![filename](../media/filename)
    protectedMarkdown = protectedMarkdown.replace(/!\[\[(.*?)\]\]/g, (match, path) => {
      const filename = path.split('/').pop();
      const encodedFilename = encodeURIComponent(filename);
      return `![${filename}](../media/${encodedFilename})`;
    });

    // Parse Markdown
    const html = marked.parse(protectedMarkdown);

    // Restore LaTeX
    const finalHtml = html.replace(/MATH_EXPRESSION_(\d+)/g, (match, index) => {
      return mathExpressions[index];
    });

    document.getElementById('content').innerHTML = finalHtml;

    if (window.MathJax && MathJax.typesetPromise) {
      MathJax.typesetPromise();
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);

      // Update active button
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('onclick').includes(theme)) {
          btn.classList.add('active');
        }
      });

      // Save preference
      localStorage.setItem('redshift-theme', theme);
    }

    // Load preference
    const savedTheme = localStorage.getItem('redshift-theme') || 'night';
    setTheme(savedTheme);
  </script>
</body>

</html>